Тук ще разясня само специфичните за бонус задачата промени, останалата информация е в документацията на оригиналната задача.

Размерът на BITMAPV4HEADER е 108 байта, затова bmpHeaders масивът става 122 байта (14 + 108).
Правим съответните промени на редове 63, 64, 85, 136.

Тъй като в оригиналната задача чета целия header в един unsigned char масив, тук не се налага да променям нищо друго, освен размера му. Изискванията, дадени по условие, които трябва да се проверят в .bmp файла са с еднакви offset-ове за BITMAPINFOHEADER и BITMAPV4HEADER, така че проверките си остават същите.

Не открих информация в интернет за това как да си генерирам такава картинка и затова предположих, че ако не отбележа "Do not write color space information" в Compatibility Options, когато export-вам картинката от GIMP, ще се получи и наистина header-ът беше такъв. Тествах с няколко различни размери на картинки и рамката изглежда правилна. Оставил съм само теста с 20x20.